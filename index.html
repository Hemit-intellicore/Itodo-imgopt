<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Compressor</title>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #f5f5f7;
      color: #1d1d1f;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    header {
      width: 100%;
      background: #e40000; /* Airtel Red */
      color: white;
      text-align: center;
      padding: 15px;
      font-size: 1.5rem;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .container {
      max-width: 900px;
      width: 100%;
      padding: 20px;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 20px;
      justify-content: center;
    }
    input, button {
      padding: 10px 15px;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 0.95rem;
    }
    button {
      background: #e40000;
      color: white;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background: #c30000;
    }
    .gallery {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      margin-bottom: 20px;
    }
    .image-card {
      background: white;
      padding: 10px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      text-align: center;
      width: 200px;
    }
    .image-card img {
      max-width: 100%;
      border-radius: 10px;
      margin-bottom: 10px;
    }
    .progress {
      width: 100%;
      background: #ddd;
      border-radius: 10px;
      overflow: hidden;
      margin: 20px 0;
    }
    .progress-bar {
      width: 0%;
      height: 12px;
      background: #e40000;
      transition: width 0.3s;
    }
    .actions {
      display: flex;
      justify-content: center;
      gap: 15px;
    }
  </style>
</head>
<body>
  <header>ðŸ“¸ Image Compressor</header>
  <div class="container">
    <div class="controls">
      <input type="file" id="upload" multiple accept="image/*">
      <input type="number" id="targetWidth" placeholder="Width (px)">
      <input type="number" id="targetHeight" placeholder="Height (px)">
      <input type="number" id="targetKB" placeholder="Target KB">
      <input type="range" id="quality" min="0.1" max="1" step="0.1" value="0.8">
      <label for="quality">Quality</label>
      <button id="compressBtn">Compress</button>
    </div>

    <div class="progress">
      <div class="progress-bar" id="progressBar"></div>
    </div>

    <div class="gallery" id="gallery"></div>

    <div class="actions">
      <button id="downloadZip">Download All as ZIP</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script>
    const upload = document.getElementById("upload");
    const compressBtn = document.getElementById("compressBtn");
    const gallery = document.getElementById("gallery");
    const progressBar = document.getElementById("progressBar");
    const downloadZipBtn = document.getElementById("downloadZip");
    let files = [];
    let compressedImages = [];

    upload.addEventListener("change", (e) => {
      files = Array.from(e.target.files);
      gallery.innerHTML = "";
      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = (event) => {
          const img = document.createElement("img");
          img.src = event.target.result;
          const card = document.createElement("div");
          card.className = "image-card";
          card.appendChild(img);
          gallery.appendChild(card);
        };
        reader.readAsDataURL(file);
      });
    });

    compressBtn.addEventListener("click", async () => {
      if (!files.length) return alert("Please upload images first!");
      compressedImages = [];
      progressBar.style.width = "0%";

      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const compressed = await compressImage(file);
        compressedImages.push({ name: file.name, blob: compressed });
        
        const reader = new FileReader();
        reader.onload = (event) => {
          const card = document.createElement("div");
          card.className = "image-card";
          const img = document.createElement("img");
          img.src = event.target.result;
          const downloadBtn = document.createElement("button");
          downloadBtn.innerText = "Download";
          downloadBtn.onclick = () => saveAs(compressed, file.name);
          card.appendChild(img);
          card.appendChild(downloadBtn);
          gallery.appendChild(card);
        };
        reader.readAsDataURL(compressed);

        progressBar.style.width = `${((i+1)/files.length)*100}%`;
      }
    });

    async function compressImage(file) {
      const targetWidth = parseInt(document.getElementById("targetWidth").value) || null;
      const targetHeight = parseInt(document.getElementById("targetHeight").value) || null;
      const targetKB = parseInt(document.getElementById("targetKB").value) || null;
      let quality = parseFloat(document.getElementById("quality").value);

      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = (event) => {
          const img = new Image();
          img.onload = () => {
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");
            let width = targetWidth || img.width;
            let height = targetHeight || img.height;
            canvas.width = width;
            canvas.height = height;
            ctx.drawImage(img, 0, 0, width, height);

            let blobPromise = new Promise((res) => canvas.toBlob(res, "image/jpeg", quality));

            blobPromise.then(blob => {
              if (targetKB) {
                const tryCompress = () => {
                  if (blob.size/1024 > targetKB && quality > 0.1) {
                    quality -= 0.05;
                    canvas.toBlob(newBlob => {
                      blob = newBlob;
                      tryCompress();
                    }, "image/jpeg", quality);
                  } else {
                    resolve(blob);
                  }
                };
                tryCompress();
              } else {
                resolve(blob);
              }
            });
          };
          img.src = event.target.result;
        };
        reader.readAsDataURL(file);
      });
    }

    downloadZipBtn.addEventListener("click", () => {
      if (!compressedImages.length) return alert("No compressed images to download!");
      const zip = new JSZip();
      compressedImages.forEach(img => {
        zip.file(img.name, img.blob);
      });
      zip.generateAsync({ type: "blob" }).then(content => {
        saveAs(content, "compressed_images.zip");
      });
    });
  </script>
</body>
</html>
